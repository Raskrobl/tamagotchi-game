<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ç–∞–º–∞–≥–æ—á–∏</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(to bottom, #04101f, #0d2438);
      color: #f4fbff;
      min-height: 100vh;
      padding: 10px;
    }
    .decor-bar {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      font-size: 18px;
      margin-bottom: 15px;
    }
    .screen {
      max-width: 520px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(13, 36, 56, 0.7);
      border-radius: 12px;
      display: none;
    }
    .screen.active {
      display: block;
    }
    h1 {
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      color: #e63946;
    }
    h2 {
      text-align: center;
      margin: 10px 0 16px;
      color: #56ccf2;
    }
    p {
      text-align: center;
      margin: 0 0 20px;
      color: #a0c4e0;
    }
    button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      background: #56ccf2;
      color: #0d2438;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      background: #444;
      cursor: not-allowed;
    }
    button.grayed {
      background: #666;
      cursor: not-allowed;
    }
    button.auth {
      background: #4361ee;
    }
    button.danger {
      background: #ef233c;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin: 6px 0 12px;
      border-radius: 4px;
      border: 1px solid #444;
      background: #0b1b2b;
      color: #f4fbff;
      font-size: 16px;
    }
    .stats-banner {
      text-align: center;
      font-style: italic;
      color: #a0e0ff;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .actions {
      display: flex;
      gap: 6px;
      margin: 16px 0;
    }
    .actions button {
      flex: 1;
      font-size: 14px;
      padding: 12px;
    }
    .footer {
      text-align: center;
      font-size: 13px;
      color: #88b0d0;
      margin-top: 6px;
    }
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #0d2438;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    .checkbox-list {
      text-align: left;
      margin: 10px 0;
    }
    .checkbox-list label {
      display: flex;
      align-items: center;
      margin: 8px 0;
      cursor: pointer;
    }
    .checkbox-list input[type="checkbox"] {
      width: auto;
      margin: 0 10px 0 0;
      cursor: pointer;
    }
    .checkbox-list input[type="radio"] {
      width: auto;
      margin: 0 10px 0 0;
      cursor: pointer;
    }
    .modal-content label {
      display: flex;
      align-items: center;
      margin: 8px 0;
      cursor: pointer;
    }
    .modal-content input[type="radio"] {
      width: auto;
      margin: 0 10px 0 0;
      cursor: pointer;
    }
    .success-message {
      background: #2e7d32;
      color: white;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
    }
    .danger-message {
      background: #d32f2f;
      color: white;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
      font-size: 18px;
    }
    #rage {
      color: #ff6b6b;
      font-weight: bold;
    }
    .warning-banner {
      background: #ff9800;
      color: #000;
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
    }
    .user-info {
      text-align: center;
      margin-bottom: 15px;
      font-size: 16px;
      color: #56ccf2;
    }
    .auth-note {
      background: #1a3a52;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      font-size: 13px;
      text-align: center;
    }
    .verification-code {
      text-align: center;
      font-size: 24px;
      letter-spacing: 5px;
      margin: 15px 0;
      color: #ffcc00;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="decor-bar">
  <span class="decor-left">‚ùÜ</span>
  <span class="decor-center">–ó–∏–º–Ω—è—è —Å–∫–∞–∑–∫–∞</span>
  <span class="decor-right">‚ùÜ</span>
</div>

<!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
<div id="auth-screen" class="screen active">
  <h1>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ç–∞–º–∞–≥–æ—á–∏</h1>
  <div class="user-info" id="current-user"></div>
  
  <div id="login-form">
    <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
    <div class="auth-note">
      ‚ö†Ô∏è –≠—Ç–æ –¥–µ–º–æ-–≤–µ—Ä—Å–∏—è. –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –±—ç–∫–µ–Ω–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º.
    </div>
    <input type="text" id="login-username" placeholder="–ù–∏–∫–Ω–µ–π–º" maxlength="15" />
    <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" maxlength="20" />
    <button class="auth" onclick="login()">–í–æ–π—Ç–∏</button>
    <button onclick="showScreen('register-screen')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  </div>
</div>

<!-- –≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
<div id="register-screen" class="screen">
  <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
  <div class="auth-note">
    –®–∞–≥ 1: –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  </div>
  <input type="email" id="register-email" placeholder="–í–∞—à email" maxlength="50" />
  <button class="auth" onclick="simulateEmailVerification()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
  <button onclick="showScreen('auth-screen')">–ù–∞–∑–∞–¥</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
<div id="verify-screen" class="screen">
  <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email</h2>
  <div class="auth-note">
    –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑–∞–Ω –∑–¥–µ—Å—å –≤–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ –ø–æ—á—Ç—É):
  </div>
  <div class="verification-code" id="verification-code-display">----</div>
  <input type="text" id="verification-code" placeholder="–ö–æ–¥ –∏–∑ 6 —Ü–∏—Ñ—Ä" maxlength="6" />
  <button class="auth" onclick="verifyCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
  <button onclick="showScreen('register-screen')">–ù–∞–∑–∞–¥</button>
</div>

<!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –Ω–∏–∫–Ω–µ–π–º–∞ -->
<div id="nickname-screen" class="screen">
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º</h2>
  <div class="auth-note">
    –ü—Ä–∏–¥—É–º–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞
  </div>
  <input type="text" id="new-username" placeholder="–ù–∏–∫–Ω–µ–π–º (3-15 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="15" />
  <input type="password" id="new-password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="20" />
  <input type="password" id="confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" maxlength="20" />
  <button class="auth" onclick="createAccount()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
  <button onclick="showScreen('verify-screen')">–ù–∞–∑–∞–¥</button>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é –∏–≥—Ä—ã -->
<div id="main-menu" class="screen">
  <div class="user-info" id="menu-user-info"></div>
  <h1 id="main-title">–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ç–∞–º–∞–≥–æ—á–∏</h1>
  <p id="main-subtitle">–ù–∞–∂–º–∏—Ç–µ "–ò–≥—Ä–∞—Ç—å", —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞!</p>
  <button onclick="showCreateScreen()">–ò–≥—Ä–∞—Ç—å</button>
  <button onclick="openSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  <button onclick="openAddons()">–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
  <button onclick="showCredits()">–°–æ–∑–¥–∞—Ç–µ–ª–∏</button>
  <button onclick="openInterfaceSettings()">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</button>
  <button onclick="openSecretMenu()">–ü–æ–¥–∞—Ä–∫–∏</button>
  <button class="danger" onclick="logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã –∏–≥—Ä—ã (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞, –∏–≥—Ä–∞, –º–∞–≥–∞–∑–∏–Ω) -->
<div id="create-screen" class="screen">
  <div class="user-info" id="create-user-info"></div>
  <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞</h2>
  <label>–ò–º—è –ø–∏—Ç–æ–º—Ü–∞:</label>
  <input type="text" id="pet-name" maxlength="20" placeholder="–ü–∏—Ç–æ–º–µ—Ü" />
  <label>–¢–∏–ø –ø–∏—Ç–æ–º—Ü–∞:</label>
  <select id="pet-type"></select>
  <button onclick="createPet()">–°–æ–∑–¥–∞—Ç—å</button>
  <button onclick="showScreen('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="game-screen" class="screen">
  <div class="user-info" id="game-user-info"></div>
  <div class="stats-banner">–¢—ë–ø–ª–∞—è –∑–∞–±–æ—Ç–∞ —Å–æ–≥—Ä–µ–µ—Ç –¥–∞–∂–µ –≤ —Å–∞–º—ã–π —Å–Ω–µ–∂–Ω—ã–π –¥–µ–Ω—å</div>
  <div id="pet-info">–ü–∏—Ç–æ–º–µ—Ü –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω.</div>
  <div id="hunger">–°—ã—Ç–æ—Å—Ç—å: -</div>
  <div id="happiness">–°—á–∞—Å—Ç—å–µ: -</div>
  <div id="energy">–≠–Ω–µ—Ä–≥–∏—è: -</div>
  <div id="rage" style="display:none;">–Ø—Ä–æ—Å—Ç—å: -/100</div>
  <div id="warning-banner" class="warning-banner" style="display:none;"></div>
  <div class="actions">
    <button id="btn-feed" onclick="onFeed()" disabled>–ö–æ—Ä–º–∏—Ç—å</button>
    <button id="btn-play" onclick="onPlay()" disabled>–ò–≥—Ä–∞—Ç—å</button>
    <button id="btn-sleep" onclick="onSleep()" disabled>–°–ø–∞—Ç—å</button>
  </div>
  <button onclick="showScreen('shop-screen')">–ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="showScreen('main-menu'); clearInterval(tickInterval); clearInterval(goldInterval); clearInterval(rageTimer);">–ù–∞–∑–∞–¥</button>
  <div class="footer">–ö–æ—Ä–º–∏—Ç–µ, –∏–≥—Ä–∞–π—Ç–µ –∏ —É–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —Å–ø–∞—Ç—å ‚Äì –∏ –ø–∏—Ç–æ–º–µ—Ü –±—É–¥–µ—Ç —Å—á–∞—Å—Ç–ª–∏–≤</div>
</div>

<div id="shop-screen" class="screen">
  <div class="user-info" id="shop-user-info"></div>
  <h2>–ú–∞–≥–∞–∑–∏–Ω —á—É–¥–µ—Å</h2>
  <p>–í–∞—à–∏ –º–æ–Ω–µ—Ç—ã: <span id="gold">0</span> ü™ô</p>
  <button onclick="buyPotion('revive')">–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è ‚Äî 50 ü™ô<br><small>–û–∂–∏–≤–ª—è–µ—Ç –º—ë—Ä—Ç–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞</small></button>
  <button onclick="buyPotion('satiety')">–ó–µ–ª—å–µ —Å—ã—Ç–æ—Å—Ç–∏ ‚Äî 30 ü™ô<br><small>–ü–∏—Ç–æ–º–µ—Ü —Å—ã—Ç 5 –º–∏–Ω—É—Ç</small></button>
  <button onclick="buyPotion('strength')">–ó–µ–ª—å–µ —Å–∏–ª—ã ‚Äî 40 ü™ô<br><small>+50 –∫–æ –≤—Å–µ–º —Å—Ç–∞—Ç–∞–º</small></button>
  <button id="btn-calm" onclick="buyPotion('calm')">–ó–µ–ª—å–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è ‚Äî 20 ü™ô<br><small>–°–Ω–∏–∂–∞–µ—Ç —è—Ä–æ—Å—Ç—å –Ω–∞ 50 (—Ç–æ–ª—å–∫–æ –¥–ª—è –î–∏–∫–∏—Ö –ó–≤–µ—Ä–µ–π)</small></button>
  <button onclick="showScreen('game-screen')">–ù–∞–∑–∞–¥ –≤ –∏–≥—Ä—É</button>
</div>

<div id="modal" class="modal">
  <div class="modal-content" id="modal-content"></div>
</div>

<script>
// ========== –°–ò–°–¢–ï–ú–ê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ==========
let currentUser = null;
let pendingEmail = null;
let verificationCode = null;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
  const savedUser = localStorage.getItem('tamagochi_current_user');
  if (savedUser) {
    currentUser = JSON.parse(savedUser);
    showScreen('main-menu');
    updateUserDisplays();
    loadGameProgress();
  } else {
    showScreen('auth-screen');
  }
  applyInterfaceMetadata();
  refreshPetTypes();
});

function updateUserDisplays() {
  const nickname = currentUser ? currentUser.username : '–ì–æ—Å—Ç—å';
  document.querySelectorAll('.user-info').forEach(el => {
    el.textContent = `üë§ ${nickname}`;
  });
  document.getElementById('menu-user-info').textContent = `üë§ ${nickname} | –ú–æ–Ω–µ—Ç—ã: ${currentUser?.gold || 0} ü™ô`;
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  
  // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π —Ñ–æ—Ä–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
  if (id === 'register-screen') {
    document.getElementById('register-email').value = '';
  } else if (id === 'verify-screen') {
    document.getElementById('verification-code').value = '';
  } else if (id === 'nickname-screen') {
    document.getElementById('new-username').value = '';
    document.getElementById('new-password').value = '';
    document.getElementById('confirm-password').value = '';
  }
}

function simulateEmailVerification() {
  const email = document.getElementById('register-email').value.trim();
  if (!email || !email.includes('@')) {
    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email!');
    return;
  }
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
  pendingEmail = email;
  
  // –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  document.getElementById('verification-code-display').textContent = verificationCode;
  
  showScreen('verify-screen');
  
  // –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ –±—ç–∫–µ–Ω–¥—É:
  // fetch('/api/send-verification', { method: 'POST', body: JSON.stringify({ email }) })
}

function verifyCode() {
  const inputCode = document.getElementById('verification-code').value.trim();
  if (inputCode === verificationCode) {
    showScreen('nickname-screen');
  } else {
    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!');
  }
}

function createAccount() {
  const username = document.getElementById('new-username').value.trim();
  const password = document.getElementById('new-password').value;
  const confirmPassword = document.getElementById('confirm-password').value;
  
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  if (username.length < 3 || username.length > 15) {
    alert('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤!');
    return;
  }
  
  if (password.length < 6) {
    alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!');
    return;
  }
  
  if (password !== confirmPassword) {
    alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∏–∫–Ω–µ–π–º–∞
  const accounts = JSON.parse(localStorage.getItem('tamagochi_accounts') || '{}');
  if (accounts[username]) {
    alert('–¢–∞–∫–æ–π –Ω–∏–∫–Ω–µ–π–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
    return;
  }
  
  // –°–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—å –Ω—É–∂–Ω–æ —Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å!)
  accounts[username] = {
    email: pendingEmail,
    password: password, // ‚ö†Ô∏è –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ!
    created: new Date().toISOString(),
    gold: 0,
    pet: null
  };
  
  localStorage.setItem('tamagochi_accounts', JSON.stringify(accounts));
  
  // –ê–≤—Ç–æ—Ä–∏–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  currentUser = {
    username: username,
    email: pendingEmail,
    gold: 0,
    pet: null
  };
  
  localStorage.setItem('tamagochi_current_user', JSON.stringify(currentUser));
  updateUserDisplays();
  
  // –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  pendingEmail = null;
  verificationCode = null;
  
  showScreen('main-menu');
  showSuccessModal('–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É!');
}

function login() {
  const username = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value;
  
  if (!username || !password) {
    alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º –∏ –ø–∞—Ä–æ–ª—å!');
    return;
  }
  
  const accounts = JSON.parse(localStorage.getItem('tamagochi_accounts') || '{}');
  const account = accounts[username];
  
  if (!account || account.password !== password) {
    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–∏–∫–Ω–µ–π–º –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
    return;
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  currentUser = {
    username: username,
    email: account.email,
    gold: account.gold || 0,
    pet: account.pet ? JSON.parse(account.pet) : null
  };
  
  localStorage.setItem('tamagochi_current_user', JSON.stringify(currentUser));
  updateUserDisplays();
  loadGameProgress();
  
  showScreen('main-menu');
}

function logout() {
  saveGameProgress();
  currentUser = null;
  localStorage.removeItem('tamagochi_current_user');
  gold = 0;
  pet = null;
  clearInterval(tickInterval);
  clearInterval(goldInterval);
  clearInterval(rageTimer);
  showScreen('auth-screen');
}

function saveGameProgress() {
  if (!currentUser) return;
  
  const accounts = JSON.parse(localStorage.getItem('tamagochi_accounts') || '{}');
  const account = accounts[currentUser.username];
  
  if (account) {
    account.gold = gold;
    account.pet = pet ? JSON.stringify({
      name: pet.name,
      petType: pet.petType,
      hunger: pet.hunger,
      happiness: pet.happiness,
      energy: pet.energy,
      rage: pet.rage,
      alive: pet.alive,
      isWildBeast: pet.isWildBeast,
      maxStat: pet.maxStat,
      rageCountdownActive: pet.rageCountdownActive,
      rageCountdownTime: pet.rageCountdownTime
    }) : null;
    
    localStorage.setItem('tamagochi_accounts', JSON.stringify(accounts));
  }
}

function loadGameProgress() {
  if (!currentUser) return;
  
  gold = currentUser.gold || 0;
  
  if (currentUser.pet) {
    const savedPet = currentUser.pet;
    pet = new Pet(savedPet.name, savedPet.petType);
    pet.hunger = savedPet.hunger;
    pet.happiness = savedPet.happiness;
    pet.energy = savedPet.energy;
    pet.alive = savedPet.alive;
    
    if (savedPet.isWildBeast) {
      pet.rage = savedPet.rage || 0;
      pet.rageCountdownActive = savedPet.rageCountdownActive || false;
      pet.rageCountdownTime = savedPet.rageCountdownTime || 0;
      
      if (pet.rageCountdownActive) {
        startRageCountdown();
      }
    }
    
    // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä—ã –∏–≥—Ä—ã
    clearInterval(tickInterval);
    tickInterval = setInterval(() => {
      if (pet) { pet.tick(); updateUI(); }
    }, 3000);
    
    clearInterval(goldInterval);
    goldInterval = setInterval(() => {
      gold += 1;
      updateUI();
    }, 5000);
  }
  
  updateUI();
}

function showSuccessModal(message) {
  const content = `
    <div class="success-message">${message}</div>
    <br>
    <button onclick="closeModal()">OK</button>
  `;
  openModal(content);
}

// ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) ==========
const BASE_PET_TYPES = ["–°–æ–±–∞–∫–∞", "–ö–æ—à–∫–∞", "–ü–æ–ø—É–≥–∞–π"];
const ADDON_PET_TYPES = [
  "–ê—Ä–∞–Ω–≥—É—Ç–∞–Ω—Ç",
  "–ß–µ—Ä–µ–ø–∞—Ö–∞",
  "–û–¥–∏–Ω–¥–∏–Ω–¥—É–Ω",
  "–ü—á–µ–ª–∞",
  "–±—Ä –±—Ä –±—Ä –±—Ä –ø–∞—Ç–∞–ø–∏–º",
  "gramma",
  "maddung",
  "Didiblat(NEW)",
  "–ö–æ—Ä–æ–≤–∞(NEW)"
];
const SECRET_PET = "–ü–∞–Ω–¥–∞ (SECRET)";
const MEGA_SECRET_PET = "–õ–µ–æ–ø–∞—Ä–¥ (MEGASECRET)";
const WILD_BEASTS = new Set([MEGA_SECRET_PET]);

let pet = null;
let enabledAddonTypes = new Set();
let interfaceStyle = "new_year";
let theme = "dark";
let tickInterval = null;
let secretUnlocked = false;
let megaSecretUnlocked = false;
let gold = 0;
let goldInterval = null;
let satietyPotionActive = false;
let satietyPotionTimer = null;
let rageTimer = null;
let gameEnded = false;

class Pet {
  constructor(name, petType) {
    this.name = name;
    this.petType = petType;
    this.isWildBeast = WILD_BEASTS.has(petType);
    
    this.maxStat = this.isWildBeast ? 300 : 100;
    this.hunger = this.maxStat;
    this.happiness = this.maxStat;
    this.energy = this.maxStat;
    this.rage = this.isWildBeast ? 0 : null;
    this.maxRage = 100;
    this.alive = true;
    this.rageCountdownActive = false;
    this.rageCountdownTime = 0;
  }

  _clampStats() {
    this.hunger = Math.max(0, Math.min(this.maxStat, this.hunger));
    this.happiness = Math.max(0, Math.min(this.maxStat, this.happiness));
    this.energy = Math.max(0, Math.min(this.maxStat, this.energy));
    
    if (this.isWildBeast && this.rage !== null) {
      this.rage = Math.max(0, Math.min(this.maxRage, this.rage));
      
      if (this.rage >= this.maxRage && !this.rageCountdownActive) {
        this.triggerRageCountdown();
      }
    }
    
    if (this.hunger === 0) this.alive = false;
  }

  feed() {
    if (!this.alive || gameEnded) return;
    this.hunger += 20;
    this.energy += 5;
    if (this.isWildBeast) {
      this.rage = Math.max(0, this.rage - 10);
    }
    this._clampStats();
  }

  play() {
    if (!this.alive || gameEnded) return;
    this.happiness += 15;
    this.hunger -= 10;
    this.energy -= 10;
    if (this.isWildBeast) {
      this.rage += 8;
    }
    this._clampStats();
  }

  sleep() {
    if (!this.alive || gameEnded) return;
    this.energy += 25;
    this.hunger -= 5;
    if (this.isWildBeast) {
      this.rage = Math.max(0, this.rage - 15);
    }
    this._clampStats();
  }

  tick() {
    if (!this.alive || gameEnded) return;
    
    if (!satietyPotionActive) {
      this.hunger -= 3;
    }
    this.happiness -= 1;
    this.energy -= 1;
    
    if (this.isWildBeast) {
      this.rage += 3;
    }
    
    this._clampStats();
  }

  revive() {
    if (!this.alive) {
      this.alive = true;
      this.hunger = Math.floor(this.maxStat / 2);
      this.happiness = Math.floor(this.maxStat / 2);
      this.energy = Math.floor(this.maxStat / 2);
      this._clampStats();
    }
  }

  boostAll() {
    this.hunger = Math.min(this.maxStat, this.hunger + 50);
    this.happiness = Math.min(this.maxStat, this.happiness + 50);
    this.energy = Math.min(this.maxStat, this.energy + 50);
    this.alive = true;
    this._clampStats();
  }

  calmDown(amount = 50) {
    if (!this.isWildBeast || !this.alive || gameEnded) return false;
    this.rage = Math.max(0, this.rage - amount);
    this._clampStats();
    return true;
  }

  triggerRageCountdown() {
    this.rageCountdownActive = true;
    this.rageCountdownTime = 300;
    
    showDangerModal("–í–∞—Å —Å—ä–µ–¥–∞–µ—Ç –î–∏–∫–∏–π –ó–≤–µ—Ä—å!");
    startRageCountdown();
  }

  endGame() {
    clearInterval(rageTimer);
    gameEnded = true;
    showDangerModal(`–í–∞—Å —Å—ä–µ–ª ${this.petType}!`);
    
    document.getElementById('btn-feed').disabled = true;
    document.getElementById('btn-play').disabled = true;
    document.getElementById('btn-sleep').disabled = true;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å (–ø–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤)
    saveGameProgress();
  }
}

function startRageCountdown() {
  clearInterval(rageTimer);
  rageTimer = setInterval(() => {
    if (!pet || !pet.rageCountdownActive) {
      clearInterval(rageTimer);
      return;
    }
    
    pet.rageCountdownTime--;
    
    if (document.getElementById('warning-banner')) {
      document.getElementById('warning-banner').textContent = 
        `‚ö†Ô∏è –î–∏–∫–∏–π –ó–≤–µ—Ä—å –Ω–∞–ø–∞–¥–µ—Ç —á–µ—Ä–µ–∑ ${Math.floor(pet.rageCountdownTime / 60)} –º–∏–Ω ${pet.rageCountdownTime % 60} —Å–µ–∫!`;
      document.getElementById('warning-banner').style.display = 'block';
    }
    
    if (pet.rageCountdownTime <= 0) {
      pet.endGame();
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –≤–æ –≤—Ä–µ–º—è –æ—Ç—Å—á–µ—Ç–∞
    if (pet.rageCountdownTime % 30 === 0) {
      saveGameProgress();
    }
  }, 1000);
}

const INTERFACE_METADATA = {
  new_year: {
    title: "–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ç–∞–º–∞–≥–æ—á–∏",
    decor: { left: "‚ùÜ", center: "–ó–∏–º–Ω—è—è —Å–∫–∞–∑–∫–∞", right: "‚ùÜ" },
    statsBanner: "–¢—ë–ø–ª–∞—è –∑–∞–±–æ—Ç–∞ —Å–æ–≥—Ä–µ–µ—Ç –¥–∞–∂–µ –≤ —Å–∞–º—ã–π —Å–Ω–µ–∂–Ω—ã–π –¥–µ–Ω—å",
    footer: "–ö–æ—Ä–º–∏—Ç–µ, –∏–≥—Ä–∞–π—Ç–µ –∏ —É–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —Å–ø–∞—Ç—å ‚Äì –∏ –ø–∏—Ç–æ–º–µ—Ü –±—É–¥–µ—Ç —Å—á–∞—Å—Ç–ª–∏–≤"
  },
  halloween: {
    title: "–•–µ–ª—É–∏–Ω—Å–∫–∏–π —Ç–∞–º–∞–≥–æ—á–∏",
    decor: { left: "[ ]", center: "–ù–æ—á—å –•–µ–ª—É–∏–Ω–∞", right: "[ ]" },
    statsBanner: "–°–ª–µ–¥–∏ –∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º —Å–≤–æ–µ–≥–æ —Ç–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞",
    footer: "–ö–æ—Ä–º–∏—Ç–µ, –∏–≥—Ä–∞–π—Ç–µ –∏ –æ—Ç–¥—ã—Ö–∞–π—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–≥–Ω–∞—Ç—å —Ç—å–º—É"
  },
  holiday: {
    title: "–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Ç–∞–º–∞–≥–æ—á–∏",
    decor: { left: "* *", center: "–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", right: "* *" },
    statsBanner: "–ü—É—Å—Ç—å –ø—Ä–∞–∑–¥–Ω–∏–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è ‚Äì –±–µ—Ä–µ–≥–∏ —Å–∏–ª—ã –∏ —Ä–∞–¥–æ—Å—Ç—å –ø–∏—Ç–æ–º—Ü–∞",
    footer: "–ò–≥—Ä—ã –∏ —É–≥–æ—â–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç –ø—Ä–∞–∑–¥–Ω–∏–∫ —è—Ä—á–µ"
  }
};

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

function openModal(content) {
  document.getElementById('modal-content').innerHTML = content;
  document.getElementById('modal').style.display = 'flex';
}

function showDangerModal(message) {
  const content = `
    <div class="danger-message">${message}</div>
    <br>
    <button onclick="closeModal()">–ü–æ–Ω—è—Ç–Ω–æ</button>
  `;
  openModal(content);
  setTimeout(closeModal, 3000);
}

function applyInterfaceMetadata() {
  const meta = INTERFACE_METADATA[interfaceStyle];
  document.title = meta.title;
  if (document.getElementById('main-title')) {
    document.getElementById('main-title').textContent = meta.title;
  }
  document.querySelector('.decor-left').textContent = meta.decor.left;
  document.querySelector('.decor-center').textContent = meta.decor.center;
  document.querySelector('.decor-right').textContent = meta.decor.right;
  if (document.querySelector('.stats-banner')) {
    document.querySelector('.stats-banner').textContent = meta.statsBanner;
  }
  if (document.querySelector('.footer')) {
    document.querySelector('.footer').textContent = meta.footer;
  }
  const bgMap = {
    new_year: 'linear-gradient(to bottom, #04101f, #0d2438)',
    halloween: 'linear-gradient(to bottom, #120818, #241020)',
    holiday: 'linear-gradient(to bottom, #021b21, #062b35)'
  };
  document.body.style.background = bgMap[interfaceStyle];
}

function refreshPetTypes() {
  const select = document.getElementById('pet-type');
  if (!select) return;
  
  select.innerHTML = '';
  const allTypes = [...BASE_PET_TYPES];
  ADDON_PET_TYPES.forEach(type => {
    if (enabledAddonTypes.has(type)) allTypes.push(type);
  });
  if (secretUnlocked) {
    allTypes.push(SECRET_PET);
  }
  if (megaSecretUnlocked) {
    allTypes.push(MEGA_SECRET_PET);
  }
  allTypes.forEach(type => {
    const option = document.createElement('option');
    option.value = type;
    option.textContent = type;
    select.appendChild(option);
  });
}

function updateUI() {
  if (!pet) {
    document.getElementById('pet-info').textContent = "–ü–∏—Ç–æ–º–µ—Ü –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω.";
    document.getElementById('hunger').textContent = "–°—ã—Ç–æ—Å—Ç—å: -";
    document.getElementById('happiness').textContent = "–°—á–∞—Å—Ç—å–µ: -";
    document.getElementById('energy').textContent = "–≠–Ω–µ—Ä–≥–∏—è: -";
    document.getElementById('rage').style.display = 'none';
    document.getElementById('warning-banner').style.display = 'none';
  } else {
    const status = pet.alive ? "–∂–∏–≤–æ–π" : "–º–µ—Ä—Ç–≤";
    document.getElementById('pet-info').textContent = `${pet.petType} –ø–æ –∏–º–µ–Ω–∏ ${pet.name} ‚Äî ${status}.`;
    document.getElementById('hunger').textContent = `–°—ã—Ç–æ—Å—Ç—å: ${pet.hunger}${satietyPotionActive ? ' (‚ú®)' : ''}`;
    document.getElementById('happiness').textContent = `–°—á–∞—Å—Ç—å–µ: ${pet.happiness}`;
    document.getElementById('energy').textContent = `–≠–Ω–µ—Ä–≥–∏—è: ${pet.energy}`;

    if (pet.isWildBeast) {
      document.getElementById('rage').style.display = 'block';
      document.getElementById('rage').textContent = `–Ø—Ä–æ—Å—Ç—å: ${pet.rage}/${pet.maxRage}`;
      
      const ragePercent = (pet.rage / pet.maxRage) * 100;
      if (ragePercent > 70) {
        document.getElementById('rage').style.color = '#d32f2f';
      } else if (ragePercent > 40) {
        document.getElementById('rage').style.color = '#ff9800';
      } else {
        document.getElementById('rage').style.color = '#4caf50';
      }
      
      if (ragePercent > 80 && !pet.rageCountdownActive) {
        document.getElementById('warning-banner').textContent = `‚ö†Ô∏è ${pet.petType} —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ–ø–∞—Å–Ω—ã–º!`;
        document.getElementById('warning-banner').style.display = 'block';
      } else if (!pet.rageCountdownActive) {
        document.getElementById('warning-banner').style.display = 'none';
      }
    } else {
      document.getElementById('rage').style.display = 'none';
      document.getElementById('warning-banner').style.display = 'none';
    }

    const buttonsEnabled = pet.alive && !gameEnded;
    document.getElementById('btn-feed').disabled = !buttonsEnabled;
    document.getElementById('btn-play').disabled = !buttonsEnabled;
    document.getElementById('btn-sleep').disabled = !buttonsEnabled;
    
    const calmBtn = document.getElementById('btn-calm');
    if (calmBtn) {
      if (pet.isWildBeast && pet.alive && !gameEnded) {
        calmBtn.classList.remove('grayed');
        calmBtn.disabled = false;
      } else {
        calmBtn.classList.add('grayed');
        calmBtn.disabled = true;
      }
    }
  }

  document.getElementById('gold').textContent = gold;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–µ–Ω—é
  if (currentUser && document.getElementById('menu-user-info')) {
    document.getElementById('menu-user-info').textContent = `üë§ ${currentUser.username} | –ú–æ–Ω–µ—Ç—ã: ${gold} ü™ô`;
  }
}

function onFeed() { if (pet) { pet.feed(); updateUI(); saveGameProgress(); } }
function onPlay() { if (pet) { pet.play(); updateUI(); saveGameProgress(); } }
function onSleep() { if (pet) { pet.sleep(); updateUI(); saveGameProgress(); } }

function buyPotion(type) {
  let cost = 0;
  let success = false;

  if (type === 'revive' && pet && !pet.alive) {
    cost = 50;
    if (gold >= cost) {
      gold -= cost;
      pet.revive();
      success = true;
    }
  } else if (type === 'satiety' && pet && pet.alive && !gameEnded) {
    cost = 30;
    if (gold >= cost) {
      gold -= cost;
      satietyPotionActive = true;
      success = true;
      if (satietyPotionTimer) clearTimeout(satietyPotionTimer);
      satietyPotionTimer = setTimeout(() => {
        satietyPotionActive = false;
        satietyPotionTimer = null;
        updateUI();
      }, 5 * 60 * 1000);
    }
  } else if (type === 'strength' && pet && !gameEnded) {
    cost = 40;
    if (gold >= cost) {
      gold -= cost;
      pet.boostAll();
      success = true;
    }
  } else if (type === 'calm' && pet && pet.isWildBeast && pet.alive && !gameEnded) {
    cost = 20;
    if (gold >= cost) {
      gold -= cost;
      pet.calmDown(50);
      success = true;
    }
  }

  if (success) {
    updateUI();
    saveGameProgress();
    const message = `<div class="success-message">‚úÖ –ö—É–ø–ª–µ–Ω–æ!</div>`;
    document.getElementById('modal-content').insertAdjacentHTML('beforeend', message);
    setTimeout(() => {
      const msg = document.querySelector('.success-message');
      if (msg) msg.remove();
    }, 2000);
  } else {
    if (type === 'calm' && pet && !pet.isWildBeast) {
      alert("–ó–µ–ª—å–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –î–∏–∫–∏—Ö –ó–≤–µ—Ä—è—Ö!");
    } else {
      alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!");
    }
  }
}

function createPet() {
  const name = document.getElementById('pet-name').value.trim() || "–ü–∏—Ç–æ–º–µ—Ü";
  const type = document.getElementById('pet-type').value;
  pet = new Pet(name, type);
  gameEnded = false;
  satietyPotionActive = false;
  if (satietyPotionTimer) {
    clearTimeout(satietyPotionTimer);
    satietyPotionTimer = null;
  }
  updateUI();
  showScreen('game-screen');

  clearInterval(tickInterval);
  tickInterval = setInterval(() => {
    if (pet) { pet.tick(); updateUI(); saveGameProgress(); }
  }, 3000);

  clearInterval(goldInterval);
  goldInterval = setInterval(() => {
    gold += 1;
    updateUI();
    if (currentUser) {
      currentUser.gold = gold;
      localStorage.setItem('tamagochi_current_user', JSON.stringify(currentUser));
    }
  }, 5000);
}

function showCreateScreen() {
  refreshPetTypes();
  showScreen('create-screen');
  if (currentUser) {
    document.getElementById('create-user-info').textContent = `üë§ ${currentUser.username}`;
  }
}

function openSettings() {
  const currentTheme = theme;
  const content = `
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <p>–¢–µ–º–∞ –∏–≥—Ä—ã:</p>
    <label>
      <input type="radio" name="theme" value="dark" ${currentTheme === 'dark' ? 'checked' : ''}>
      –¢—ë–º–Ω–∞—è
    </label>
    <label>
      <input type="radio" name="theme" value="light" ${currentTheme === 'light' ? 'checked' : ''}>
      –°–≤–µ—Ç–ª–∞—è
    </label>
    <br><br>
    <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  `;
  openModal(content);
}

function saveSettings() {
  const radios = document.getElementsByName('theme');
  for (let radio of radios) if (radio.checked) theme = radio.value;
  closeModal();
}

function showCredits() {
  openModal(`
    <h3>–°–æ–∑–¥–∞—Ç–µ–ª–∏</h3>
    <p>Raskrobl(Honexe) - —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π.</p>
    <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
  `);
}

function openAddons() {
  let checkboxes = '';
  ADDON_PET_TYPES.forEach(type => {
    const checked = enabledAddonTypes.has(type) ? 'checked' : '';
    checkboxes += `<label><input type="checkbox" value="${type}" ${checked}> ${type}</label>`;
  });
  const content = `
    <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∂–∏–≤–æ—Ç–Ω—ã–µ:</h3>
    <div class="checkbox-list">${checkboxes}</div>
    <br>
    <button onclick="saveAddons()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  `;
  openModal(content);
}

function saveAddons() {
  enabledAddonTypes.clear();
  document.querySelectorAll('#modal-content input[type="checkbox"]:checked')
    .forEach(cb => enabledAddonTypes.add(cb.value));
  closeModal();
  refreshPetTypes();
}

function openInterfaceSettings() {
  const current = interfaceStyle;
  const content = `
    <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</h3>
    <label>
      <input type="radio" name="iface" value="new_year" ${current === 'new_year' ? 'checked' : ''}>
      –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–±–∞–∑–æ–≤—ã–π)
    </label>
    <label>
      <input type="radio" name="iface" value="halloween" ${current === 'halloween' ? 'checked' : ''}>
      –•–µ–ª—É–∏–Ω—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    </label>
    <label>
      <input type="radio" name="iface" value="holiday" ${current === 'holiday' ? 'checked' : ''}>
      –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    </label>
    <br><br>
    <button onclick="saveInterface()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  `;
  openModal(content);
}

function saveInterface() {
  const radios = document.getElementsByName('iface');
  for (let radio of radios) if (radio.checked) interfaceStyle = radio.value;
  applyInterfaceMetadata();
  closeModal();
}

function openSecretMenu() {
  const content = `
    <h3>–ü–æ–¥–∞—Ä–∫–∏</h3>
    <p>–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–æ–±–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ:</p>
    <input type="password" id="secret-code" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="20" />
    <br><br>
    <button onclick="submitSecretCode()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
  `;
  openModal(content);
}

function submitSecretCode() {
  const code = document.getElementById('secret-code').value.trim();
  if (code === "1x1x1") {
    secretUnlocked = true;
    const message = `<div class="success-message">‚úÖ –°–µ–∫—Ä–µ—Ç–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ ¬´${SECRET_PET}¬ª –¥–æ–±–∞–≤–ª–µ–Ω–æ!</div>`;
    document.getElementById('modal-content').insertAdjacentHTML('beforeend', message);
    refreshPetTypes();
  } else if (code === "–í–∫–∞–º–∏–Ω–µ–≤—à–µ—Å—Ç—å—É—Ç—Ä–∞") {
    megaSecretUnlocked = true;
    const message = `<div class="success-message">‚úÖ MEGASECRET –∂–∏–≤–æ—Ç–Ω–æ–µ ¬´${MEGA_SECRET_PET}¬ª –¥–æ–±–∞–≤–ª–µ–Ω–æ!</div>`;
    document.getElementById('modal-content').insertAdjacentHTML('beforeend', message);
    refreshPetTypes();
  } else {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
  }
}

document.getElementById('modal').onclick = function(e) {
  if (e.target === this) closeModal();
};

// –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –¥–µ–º–æ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
document.addEventListener('keydown', (e) => {
  if (e.key === 'F1') {
    // –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    if (document.getElementById('auth-screen').classList.contains('active')) {
      pendingEmail = 'demo@example.com';
      verificationCode = '123456';
      document.getElementById('verification-code-display').textContent = verificationCode;
      currentUser = {
        username: 'DemoUser',
        email: 'demo@example.com',
        gold: 100,
        pet: null
      };
      localStorage.setItem('tamagochi_current_user', JSON.stringify(currentUser));
      
      // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç
      const accounts = JSON.parse(localStorage.getItem('tamagochi_accounts') || '{}');
      accounts['DemoUser'] = {
        email: 'demo@example.com',
        password: 'demo123',
        created: new Date().toISOString(),
        gold: 100,
        pet: null
      };
      localStorage.setItem('tamagochi_accounts', JSON.stringify(accounts));
      
      updateUserDisplays();
      showScreen('main-menu');
      alert('–î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ù–∏–∫: DemoUser, –ü–∞—Ä–æ–ª—å: demo123');
    }
  }
});
</script>

</body>
</html>
